# Misskey プロフィール要約ジェネレーター

技術仕様書 (SPEC)1. 概要 (Overview)本プロジェクトは、Misskeyユーザーのプロフィール情報および投稿（ノート）をLLM（大規模言語モデル）に渡し、自己紹介文を自動生成する静的なウェブアプリケーションである。

ユーザーはMiAuth認証またはノートのエクスポートJSONファイルを使用し、自身のLLM APIキーを入力することで、サーバーを介さずにクライアントサイドで完結する形でプロフィール要約を生成できる。
2. コンセプト (Concept)手軽な自己分析: 自身の投稿と思考の傾向をAIの視点から客観的に要約し、新しい自己紹介文のインスピレーションを得る。プライバシー保護: ユーザーの認証情報やAPIキー、ノート情報は外部サーバーに送信・保存せず、すべてブラウザ上で処理を完結させる。ポータビリティ: 単一のHTMLファイルとして提供され、ダウンロードしてローカル環境で開くだけで利用可能。
3. 主な機能 (Features)データ入力方法の選択:MiAuth認証: MisskeyインスタンスのURLを入力し、MiAuth連携でプロフィールとノート情報を取得する。
  JSONファイルアップロード: MisskeyからエクスポートしたノートのJSONファイルを直接読み込む。LLM APIキー入力: ユーザーが利用したいLLMのAPIキーを入力するフォーム。情報取得範囲の設定:プロフィール情報: name, bio, location を利用する。
ノート: public, home, followers の公開範囲から、要約に使用するノートを選択できる。プロンプトのカスタマイズ（オプション）: 要約を生成するための基本的なプロンプトを編集できる機能。

結果の表示とコピー: 生成された自己紹介文を表示し、クリップボードにコピーするボタンを設置する。
4. 技術仕様 (Technical Specifications)
フロントエンド:言語: HTML, CSS, JavaScript (Vanilla JS)
フレームワーク/ライブラリ: なし（依存関係をなくし、単一ファイルでの動作を容易にするため）
データソース:Misskey API (MiAuth経由)Misskey Note Export JSONLLM API:OpenAI互換, Google (Gemini Not Vertex AI) など、主要なAPIエンドポイントに対応できるよう、リクエスト先URLとリクエストボディを柔軟に設定できる構造にする。デフォルトは汎用的なものを設定しておく。
5. 処理フロー (Workflow)ユーザーのアクション（入力）:
(A) MiAuthの場合:MisskeyインスタンスのURLを入力。「MiAuthで認証」ボタンをクリックし、Misskeyの認証ページへリダイレクト。認証後、コールバックでアクセストークンを取得。
(B) JSONファイルの場合:ファイル選択ダイアログでノートのエクスポートJSONファイルをアップロード。
続いて、4. LLMのAPIキーを入力。
5. 要約に含めるノートの公開範囲（public, home, followers）を選択。6. 「生成」ボタンをクリック。データ取得と整形 (クライアントサイドJS):
(A) MiAuthの場合:取得したアクセストークンを使い、/api/i エンドポイントからプロフィール情報 (name, bio, location) を取得。/api/notes エンドポイントから、指定された公開範囲のノートを複数取得。
(B) JSONファイルの場合:アップロードされたJSONファイルをパースし、ノートのテキストを抽出。プロフィール情報はJSONに含まれないため、別途入力フォームを設けるか、ノート内容から推測させる前提とする。取得したプロフィール情報とノートのテキストを結合し、一つのテキストデータに整形する。LLMへのリクエスト (クライアントサイドJS):
整形したテキストデータを、あらかじめ定義されたプロンプトテンプレートに挿入する。ユーザーが入力したAPIキーをヘッダーに含め、LLMのAPIエンドポイントにfetchでPOSTリクエストを送信。結果の表示:LLMから返却されたJSONレスポンスをパースし、要約テキストを抽出。画面上の指定された領域に、生成されたテキストを表示する。
6. LLMへのプロンプト例 (Prompt Example)以下は、LLMに送信するプロンプトの基本テンプレート案です。

# 命令書

## Prompt

### System

```System Prompt1
リスト記法は対応しておらず、パーサーが壊れるため使用禁止です。列挙する場合は「・」を使ってください。
```

```System Prompt_Profile Prompt
プロフィール情報と投稿から、このユーザーの興味関心、性格、口調の傾向を簡潔に教えてください。
```

# 制約条件

- できるだけ簡潔に書いてください(文字数を増やしすぎると、outputの価格にダメージを与えるが、丁度いい塩梅を見つける必要がある。)
- 箇条書きは使用せず、自然な文章にしてください。
- 友好的で、少し個性的なトーンで書いてください。
- 入力情報から、その人の興味、関心、性格などを推測して文章に反映させてください。

# input

## プロフィール

- 名前: {{userName}}
- 自己紹介(Bio): {{userBio}}
- 場所: {{userLocation}}

## 最近の投稿

{{userNotes}}

# output
## プロフィールから読み取れる情報
{{profile_summarize}}

## ノートから読み取れる情報

### 興味関心
{{興味関心}}

### 性格
{{性格}}

### 口調
{{口調}}

補足: この仕様書は、他の開発者やAIエージェントがプロジェクトの全体像を把握し、具体的な実装に着手するためのガイドラインとして使用できます。
その他改善点などがある場合は、spec.mdを先に編集し、プランを変更してからtodoにして細かく実行していくこと

# 元の実装のコード達
srcに元のmisskey frontendで使われていたであろうコードを一部拝借済みである。しかし足りない情報等はユーザーもしくは自律的に検索を行い、調査をすること。

7. 詳細設計メモ (Design Notes)
- UI全体はパステルピンク(#f9e1ec)を基調に柔らかい色調で統一し、視認性を確保するためにコントラスト比AAを満たすアクセントカラーを選定する。
- フォームレイアウトはデスクトップでは2カラム、モバイルでは1カラムに自動調整するレスポンシブ構成とする。
- ステータス表示用の`aria-live`リージョンを設置し、生成処理やエラー情報をリアルタイムに読み上げ可能にする。

8. 認証・データ取得フロー (Auth/Data Flow)
- MiAuth利用時はUUIDセッションIDを生成し、`https://{instance}/miauth/{session}`で権限要求を行う。
- コールバックURLはHTTPSホストまたはカスタムスキームを想定し、`file://`での利用時には簡易ローカルサーバー起動またはJSONインポートの案内を表示する。
- MiAuth成功後は`/api/i`でプロフィール、`/api/notes`でノートを取得し、ユーザーが選択した公開範囲(public/home/followers)と件数上限を適用してフィルタリングする。
- MiAuthのコールバックは`callback.html`へリダイレクトさせ、ブラウザ上で取得したアクセストークンとユーザー情報を表示。ユーザーがコピーして`index.html`に貼り付けるフローを基本とし、同一オリジンの場合はlocalStorage/postMessage連携で自動入力も可能にする。
- JSONインポートはMisskeyのノートエクスポートJSONに加え、他形式でもフィールドマッピングができるよう柔軟にパーサーを用意する。
- ノート取得はキャッシュベースで管理し、追記/上書きモードの切り替えやキャッシュクリア・エクスポート機能を提供する。フィルターやバッチ処理はキャッシュ上のデータを対象とし、必要に応じて段階的取得が可能。
- 取得処理は専用ボタンまたは生成時の自動ステップで実行し、キャッシュを優先しつつ不足分を順次フェッチする。重複スキップや重複クリーンアップを設定できるようにする。

9. LLM連携仕様 (LLM Integration)
- OpenAI互換API (Chat Completions) と Google Gemini API (generateContent) をプリセットとして提供し、そのほかのエンドポイントへPOSTできるカスタムモードを実装する。
- プロンプトテンプレートはSystem/Instruction/Userの3領域を編集可能にし、テンプレートへのプレースホルダー(`{{profile}}`, `{{notes}}`など)差し込みをサポートする。
- Geminiプリセットは最新の`generativelanguage.googleapis.com`モデル一覧をAPI経由で取得し、候補リストとして提示する。モデルがThinkingモードに対応している場合は思考バジェットを個別に設定/無制限化できるようにする。
- APIキーやモデル名はデフォルトで保存せず、ユーザーが「設定を保存」トグルを有効にした場合のみ`localStorage`に暗号化なしで保存する旨を明示する。
- 最大出力トークンは入力欄を空または0で無制限扱いとし、ユーザーが必要に応じて明示的に上限を設定できるようにする。
- 生成結果はコピーと`.txt`ダウンロードの両方を提供し、履歴として最大5件まで保持する。

10. エラーハンドリングとテスト (Error Handling & Tests)
- すべてのAPIリクエストで成功・失敗をステップごとに可視化し、詳細エラーは折りたたみ可能なログ領域に出力する。
- JSON/ノートパース処理についてはNode.js上で実行できる簡易テストスクリプトを用意し、ダミーデータで検証可能にする。
- タスク完了時に一時ファイルやデバッグ用スクリプトは削除する運用ルールを徹底する。
